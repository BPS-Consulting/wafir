{
  "openapi": "3.0.3",
  "info": {
    "title": "Fastify Lambda API",
    "description": "Serverless API documentation generated from route schemas",
    "version": "1.0.0"
  },
  "components": {
    "schemas": {}
  },
  "paths": {
    "/auth/github": {
      "get": {
        "summary": "Initiate GitHub OAuth",
        "tags": [
          "Auth"
        ],
        "description": "Redirects to GitHub OAuth for user authorization",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "query",
            "name": "installationId",
            "required": true
          },
          {
            "schema": {
              "type": "string"
            },
            "in": "query",
            "name": "returnUrl",
            "required": false
          }
        ],
        "responses": {
          "200": {
            "description": "Default Response"
          }
        }
      }
    },
    "/auth/github/callback": {
      "get": {
        "summary": "GitHub OAuth Callback",
        "tags": [
          "Auth"
        ],
        "description": "Handles OAuth callback from GitHub",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "query",
            "name": "code",
            "required": true
          },
          {
            "schema": {
              "type": "string"
            },
            "in": "query",
            "name": "state",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Default Response"
          }
        }
      }
    },
    "/auth/status/{installationId}": {
      "get": {
        "summary": "Check Auth Status",
        "tags": [
          "Auth"
        ],
        "description": "Check if user token exists for installation",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "path",
            "name": "installationId",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "connected": {
                      "type": "boolean"
                    },
                    "installationId": {
                      "type": "number"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/auth/{installationId}": {
      "delete": {
        "summary": "Disconnect Auth",
        "tags": [
          "Auth"
        ],
        "description": "Remove stored user token for installation",
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "in": "path",
            "name": "installationId",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Default Response"
          }
        }
      }
    },
    "/config/": {
      "get": {
        "summary": "Get WAFIR Configuration (Deprecated)",
        "tags": [
          "WAFIR"
        ],
        "description": "DEPRECATED: The widget now fetches config directly from a user-hosted URL. This endpoint is kept for backward compatibility but will be removed in a future version. Fetches and parses .github/wafir.yaml from the target repository.",
        "parameters": [
          {
            "schema": {
              "type": "number"
            },
            "in": "query",
            "name": "installationId",
            "required": true
          },
          {
            "schema": {
              "type": "string"
            },
            "in": "query",
            "name": "owner",
            "required": true
          },
          {
            "schema": {
              "type": "string"
            },
            "in": "query",
            "name": "repo",
            "required": true
          }
        ],
        "deprecated": true,
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "targets"
                  ],
                  "properties": {
                    "title": {
                      "type": "string",
                      "default": "Contact Us",
                      "description": "Modal title"
                    },
                    "targets": {
                      "type": "array",
                      "minItems": 1,
                      "description": "Target destinations for form submissions. Each target defines where and how submissions are stored.",
                      "items": {
                        "type": "object",
                        "required": [
                          "id",
                          "type",
                          "target",
                          "authRef"
                        ],
                        "properties": {
                          "id": {
                            "type": "string",
                            "description": "Unique identifier for this target, referenced by forms to route submissions."
                          },
                          "type": {
                            "type": "string",
                            "enum": [
                              "github/issues",
                              "github/project"
                            ],
                            "description": "Target type using MIME-type convention. Currently supported: github/issues, github/project."
                          },
                          "target": {
                            "type": "string",
                            "description": "Target identifier. Format depends on type: 'owner/repo' for github/issues, 'owner/projectNum' for github/project."
                          },
                          "authRef": {
                            "type": "string",
                            "description": "Authentication reference used to authorize communication with the target. For GitHub types, this is the installation ID."
                          }
                        },
                        "additionalProperties": false
                      }
                    },
                    "telemetry": {
                      "type": "object",
                      "description": "Automatic data collection settings",
                      "properties": {
                        "screenshot": {
                          "type": "boolean",
                          "default": true,
                          "description": "Enable screenshot capture"
                        },
                        "browserInfo": {
                          "type": "boolean",
                          "default": true,
                          "description": "Collect URL, user agent, viewport, language"
                        },
                        "consoleLog": {
                          "type": "boolean",
                          "default": false,
                          "description": "Capture console messages"
                        }
                      }
                    },
                    "forms": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "required": [
                          "id"
                        ],
                        "properties": {
                          "id": {
                            "type": "string",
                            "description": "Unique form identifier"
                          },
                          "label": {
                            "type": "string",
                            "description": "Display label (defaults to capitalized id)"
                          },
                          "icon": {
                            "type": "string",
                            "enum": [
                              "thumbsup",
                              "lightbulb",
                              "bug"
                            ],
                            "description": "Form icon (displayed in tab UI)"
                          },
                          "fields": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "required": [
                                "type"
                              ],
                              "properties": {
                                "type": {
                                  "type": "string",
                                  "enum": [
                                    "input",
                                    "email",
                                    "textarea",
                                    "dropdown",
                                    "checkboxes",
                                    "markdown",
                                    "rating"
                                  ],
                                  "description": "Field input type. Matches GitHub Form Schema types plus Wafir extensions."
                                },
                                "id": {
                                  "type": "string",
                                  "description": "Unique identifier for the field (used as key in JSON output/issue body)."
                                },
                                "attributes": {
                                  "type": "object",
                                  "description": "Visual and behavioral attributes for the field.",
                                  "properties": {
                                    "label": {
                                      "type": "string",
                                      "description": "Display label for the field."
                                    },
                                    "description": {
                                      "type": "string",
                                      "description": "Helper text displayed below the label."
                                    },
                                    "placeholder": {
                                      "type": "string",
                                      "description": "Placeholder text (input, textarea, email only)."
                                    },
                                    "value": {
                                      "type": "string",
                                      "description": "Default value or the Markdown content (markdown type)."
                                    },
                                    "render": {
                                      "type": "string",
                                      "description": "Syntax highlighting style for textarea (e.g., 'shell', 'javascript')."
                                    },
                                    "multiple": {
                                      "type": "boolean",
                                      "description": "Allow multiple selections (dropdown type only)."
                                    },
                                    "options": {
                                      "description": "Options for dropdown or checkboxes.",
                                      "oneOf": [
                                        {
                                          "type": "array",
                                          "items": {
                                            "type": "string"
                                          }
                                        },
                                        {
                                          "type": "array",
                                          "items": {
                                            "type": "object",
                                            "required": [
                                              "label"
                                            ],
                                            "properties": {
                                              "label": {
                                                "type": "string"
                                              },
                                              "required": {
                                                "type": "boolean"
                                              }
                                            }
                                          }
                                        }
                                      ]
                                    },
                                    "ratingLabels": {
                                      "type": "array",
                                      "items": {
                                        "type": "string"
                                      },
                                      "description": "Custom labels for star rating (Wafir extension only)."
                                    }
                                  }
                                },
                                "validations": {
                                  "type": "object",
                                  "properties": {
                                    "required": {
                                      "type": "boolean",
                                      "description": "Whether the field is required."
                                    }
                                  }
                                }
                              }
                            },
                            "description": "Form fields for this form. If omitted, defaults are used for known form IDs."
                          },
                          "targets": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            },
                            "description": "IDs of target(s) for this form. If omitted or empty, all targets will be used. Each ID must reference a valid target from the top-level targets array."
                          },
                          "labels": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            },
                            "description": "Labels automatically added to issues created from this form. Similar to GitHub issue form templates."
                          },
                          "templateUrl": {
                            "type": "string",
                            "format": "uri",
                            "description": "URL to a GitHub issue form template YAML file. When provided, the form fields will be fetched from this template."
                          }
                        }
                      },
                      "description": "Widget forms configuration. Forms are displayed as tabs in the UI. Defaults to feedback, suggestion, issue if omitted."
                    },
                    "issueTypes": {
                      "type": "array",
                      "description": "Available issue types from the organization (auto-populated)",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "number"
                          },
                          "name": {
                            "type": "string"
                          },
                          "color": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  },
                  "additionalProperties": false
                }
              }
            }
          },
          "404": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/health/": {
      "get": {
        "summary": "Health Check",
        "tags": [
          "Health"
        ],
        "description": "Returns the health status of the bridge service",
        "responses": {
          "200": {
            "description": "Default Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string"
                    },
                    "timestamp": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/submit/": {
      "post": {
        "summary": "Submit Feedback/Issue",
        "tags": [
          "WAFIR"
        ],
        "description": "Creates a GitHub issue or project draft from form fields. Supports multipart/form-data.",
        "responses": {
          "200": {
            "description": "Default Response"
          }
        }
      }
    }
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Local Development Server"
    }
  ]
}